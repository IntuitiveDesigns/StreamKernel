# =============================================================================
# StreamKernel Profile: secure-durable-mtls-opa
# Purpose: "Enterprise" posture: mTLS + OPA RBAC + durable producer + durable DLQ
# =============================================================================

pipeline.name=StreamKernel-Enterprise
pipeline.version=4.0.0-Secure
app.service.account=service-account-1

pipeline.parallelism=24
pipeline.app.batch.size=1000

metrics.enabled=true
metrics.type=PROMETHEUS
metrics.prometheus.port=8080
streamkernel.speedometer.window.seconds=5

# --- Synthetic source (String payloads) ---
source.type=SYNTHETIC
source.synthetic.payload.size=1024
source.synthetic.high.entropy=false

# --- Kafka sink ---
sink.type=KAFKA
sink.topic=arena-bench-test

# --- Transform / cache ---
transform.type=NOOP
cache.type=NOOP

# =============================================================================
# OPA Authorization (topic-level)
# =============================================================================
security.opa.url=http://localhost:8181/v1/data/streamkernel/authz/allow
security.opa.enabled=true
security.opa.user=${app.service.account}
security.opa.action=write
security.opa.resource=${sink.topic}
security.opa.cache.ttl.ms=1000
security.opa.timeout.ms=500
security.opa.failClosed=true

# =============================================================================
# Kafka mTLS
# =============================================================================
kafka.broker=localhost:9093
kafka.security.protocol=SSL
kafka.ssl.endpoint.identification.algorithm=
kafka.ssl.keystore.location=C:/workspace/StreamKernel/secrets/kafka.client.keystore.p12
kafka.ssl.truststore.location=C:/workspace/StreamKernel/secrets/kafka.truststore.p12
kafka.ssl.keystore.type=PKCS12
kafka.ssl.truststore.type=PKCS12
kafka.ssl.truststore.password=changeit
kafka.ssl.keystore.password=changeit
kafka.ssl.key.password=changeit

# =============================================================================
# Producer tuning (durable intent)
# =============================================================================
kafka.producer.acks=all
kafka.producer.idempotence=true
kafka.producer.retries=2147483647
kafka.producer.delivery.timeout.ms=120000
kafka.producer.max.in.flight.requests.per.connection=5

kafka.producer.compression=lz4
kafka.producer.batch.size=65536
kafka.producer.linger.ms=5
kafka.producer.buffer.memory=268435456
kafka.producer.max.request.size=10485760

# =============================================================================
# DLQ (durable)
# =============================================================================
dlq.type=KAFKA_DLQ
dlq.topic=streamkernel-dlq
dlq.serializer.type=STRING
dlq.kafka.producer.acks=all
dlq.kafka.producer.idempotence=true
dlq.kafka.producer.retries=2147483647
dlq.kafka.producer.linger.ms=5
dlq.kafka.producer.batch.size=65536
dlq.kafka.producer.compression=lz4
