# =============================================================================
# StreamKernel - Secure + Durable + mTLS + OPA (Docker profile)
# File: config/profiles/secure-durable-mtls-opa.docker.properties
# =============================================================================

# ------------------------------
# Required identity
# ------------------------------
pipeline.name=streamkernel-secure-docker

# ------------------------------
# REQUIRED: pipeline wiring
# (These are the keys your PipelineFactory.require(...) is failing on.)
# ------------------------------
# Sources available per logs: SYNTHETIC, SYNTHETIC_AVRO
source.type=SYNTHETIC

# Sinks available per logs: KAFKA, DEVNULL, DLQ_LOG, KAFKA_AVRO, MONGODB, KAFKA_DLQ
# For "healthy run" choose DEVNULL first. Once stable, switch to KAFKA or KAFKA_AVRO.
sink.type=DEVNULL

# Transformers available per logs: NOOP, UPPER, AI_ENRICHMENT
transform.type=NOOP

# Caches available per logs: NOOP, LOCAL
cache.type=NOOP


# =============================================================================
# Performance knobs (safe defaults)
# =============================================================================
# Your app prints Parallelism=50 | AppBatchSize=4000 from config today.
# Keep these reasonable until the container is stable.
pipeline.parallelism=50
pipeline.batch.size=4000

# If your code supports these (harmless if ignored):
pipeline.flush.interval.ms=50
pipeline.backpressure.max.inflight=200000


# =============================================================================
# Security: OPA authorization (Docker DNS)
# =============================================================================
# Your current file uses this URL. Keep it.
security.opa.url=http://opa:8181/v1/data/streamkernel/authz/allow

# If your code supports a toggle (harmless if ignored):
security.opa.enabled=true


# =============================================================================
# Kafka client (Docker internal mTLS)
# =============================================================================
# Docker Compose service name is arena-broker; BUT your config says "broker:29094".
# In your compose output, the service name is "broker" and container name is "arena-broker".
# So "broker:29094" is correct for in-network DNS.
kafka.broker=broker:29094

# Standard Kafka SSL config
kafka.security.protocol=SSL

# Mounted secrets inside container
kafka.ssl.keystore.location=/etc/streamkernel/secrets/kafka.client.keystore.p12
kafka.ssl.truststore.location=/etc/streamkernel/secrets/kafka.truststore.p12
kafka.ssl.keystore.type=PKCS12
kafka.ssl.truststore.type=PKCS12
kafka.ssl.keystore.password=changeit
kafka.ssl.key.password=changeit
kafka.ssl.truststore.password=changeit

# Recommended: keep endpoint identification ON.
# If you generated certs without proper SANs for "broker", you may need to set this empty to get unstuck.
kafka.ssl.endpoint.identification.algorithm=https


# =============================================================================
# Topics / DLQ (optional; ignored if sink.type=DEVNULL)
# =============================================================================
kafka.topic.out=streamkernel.out
kafka.topic.dlq=streamkernel.dlq

# If you have a durable DLQ sink option:
dlq.enabled=true
dlq.sink.type=KAFKA_DLQ


# =============================================================================
# Metrics (Prometheus)
# =============================================================================
metrics.enabled=true
metrics.type=PROMETHEUS
metrics.port=8080
metrics.path=/actuator/prometheus
